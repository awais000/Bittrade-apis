{"version":3,"sources":["../../server/controllers/product.controller.js"],"names":["Product","require","productController","getCount","req","res","count","countDocuments","json","createProduct","errors","array","length","status","files","body","description","title","price","stock","imagesUrl","map","filename","Date","now","file","originalname","containerUrl","BlockBlobURL","then","console","log","catch","error","push","url","product","images","save","err","getProductsPagination","next","perPage","page","query","find","skip","limit","exec","products","current","pages","Math","ceil","AddFavoriteProduct","userId","productid","findOne","data","favoriteproduct","favoriteProduct","success","message","GetFavoriteProducts","id","params","removeFavoriteProduct","remove","_id","obj","result","n","editProduct","code","size","weight","discount","on_sale","active","broken_stock","to_serve","to_receive","ubication","findByIdAndUpdate","$set","new","getActives","getInactives","getActivesCount","getInactivesCount","getProduct","findById","deleteProduct","findByIdAndRemove","activateProduct","update","deactivateProduct","addImage","image","brokenStock","broken","$where","module","exports"],"mappings":"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","file":"product.controller.js","sourcesContent":["const Product = require(\"../models/products\");\r\nimport { containerUrlFrom, BlockBlobURLFrom, uploadStream } from \"../azure\";\r\nimport {myValidationResult} from \"../utils/util\"\r\nimport uuid from \"uuid-v4\";\r\nimport favoriteProduct from \"../models/favoriteProducts\";\r\n\r\nconst productController = {};\r\n\r\n\r\n\r\n\r\n// productController.getProducts = async (req, res) => {\r\n//   // console.log('api/products/   ---getProducts');\r\n//   const products = await Product.find();\r\n\r\n//   res.json({ products });\r\n// };\r\n\r\nproductController.getCount = async (req, res) => {\r\n  const count = await Product.countDocuments();\r\n\r\n  res.json(count);\r\n};\r\n\r\nproductController.createProduct = async (req, res) => {\r\n  try {\r\n    const errors = myValidationResult(req).array(); // Finds the validation errors in this request and wraps them in an object with handy functions\r\n\r\n    if (errors.length>0) {\r\n      res.status(422).json({ errors: errors});\r\n      return;\r\n    }\r\n    const {files}=req;\r\n    const {description,title,price,stock}=req.body;\r\n    let imagesUrl = [];\r\n    if (files && files.length>0) {\r\n        files.map(file => {\r\n       \r\n          let filename = `${Date.now()}-${uuid()}${file.originalname}`;\r\n          const containerUrl = containerUrlFrom();\r\n          const BlockBlobURL = BlockBlobURLFrom(containerUrl, filename);\r\n          uploadStream(BlockBlobURL, file)\r\n            .then(() => console.log(\"files uploaded to server\"))\r\n            .catch(error => console.log(`Error - ${error}`));\r\n          imagesUrl.push(BlockBlobURL.url);\r\n        \r\n      });\r\n    \r\n    }\r\n\r\n    const product = new Product({description,title,price,stock,images:imagesUrl});\r\n\r\n    await product.save(err => {\r\n      if (err) {\r\n        res.json({ error: err });\r\n      } else {\r\n        res.json({ status: \"200\", product });\r\n      }\r\n    });\r\n  } catch (err) {\r\n    res.json({ error: err });\r\n  }\r\n};\r\n\r\nproductController.getProductsPagination=async (req, res, next)=> {\r\n  var perPage = 10\r\n  var page = req.query.page || 1\r\n\r\n  Product\r\n      .find({})\r\n      .skip((perPage * page) - perPage)\r\n      .limit(perPage)\r\n      .exec((err, products) =>{\r\n        if (err) return next(err)\r\n          Product.count().exec((err, count)=> {\r\n              if (err) return next(err)\r\n              res.json({\r\n                  products: products,\r\n                  current: page,\r\n                  pages: Math.ceil(count / perPage)\r\n              })\r\n          })\r\n      })\r\n}\r\n\r\nproductController.AddFavoriteProduct=async (req, res, next)=> {\r\n  try {\r\n    // const errors = myValidationResult(req).array(); // Finds the validation errors in this request and wraps them in an object with handy functions\r\n\r\n    // if (errors.length>0) {\r\n    //   res.status(422).json({ errors: errors});\r\n    //   return;\r\n    // }\r\n  \r\n    const {userId,productid}=req.body;\r\n    \r\n    Product.findOne({ productid }, async (err, data) =>{\r\n      if (err) {\r\n        res.status(422).json({ errors: res });\r\n        return;\r\n      }\r\n      if (data) {\r\n        const favoriteproduct = new favoriteProduct({userId,product:data});\r\n\r\n    await favoriteproduct.save(err => {\r\n      if (err) {\r\n        res.status(400).json({ error: err });\r\n      } else {\r\n        res.status(200).json({ status: \"200\", favoriteproduct });\r\n      }\r\n    });\r\n      } else {\r\n        res.status(400).json({success:false,message:\"This product doesn't exsist\"});\r\n      }\r\n    });\r\n    \r\n\r\n  } catch (err) {\r\n    res.status(400).json({ error: err });\r\n  }\r\n}\r\n\r\n\r\nproductController.GetFavoriteProducts=async (req, res, next)=> {\r\n\r\n  const id=req.params.id;\r\n    \r\n  favoriteProduct.find({ userId:id }, function(err, data) {\r\n    if (err) {\r\n      res.status(422).json({ errors: res });\r\n      return;\r\n    }\r\n    if (data) {\r\n      res.status(200).json({success:true,message:\"There is the list of your favorite Products\",product:data});\r\n    } else {\r\n      res.status(400).json({success:false,message:\"You don't have any Faviorate right now\"});\r\n    }\r\n  });\r\n  \r\n}\r\n\r\nproductController.removeFavoriteProduct = async (req, res) => {\r\n  const { productid,userId } = req.query;\r\n  Product.\r\n  remove({_id:userId,product:{_id:productid}},function(err, obj) {\r\n     if (err)  res.status(400).json({ error: err });\r\n    console.log(obj.result.n + \" document(s) deleted\");\r\n  })\r\n\r\n};\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//Todo-- implement it correclty\r\nproductController.editProduct = async (req, res) => {\r\n  const { _id} = req.params;\r\n   \r\n  const product = {\r\n    code: req.body.code,\r\n    description: req.body.description,\r\n    size: req.body.size,\r\n    weight: req.body.weight,\r\n    price: req.body.price,\r\n    discount: req.body.discount,\r\n    on_sale: req.body.on_sale,\r\n    active: req.body.active,\r\n    stock: req.body.stock,\r\n    broken_stock: req.body.broken_stock,\r\n    to_serve: req.body.to_serve,\r\n    to_receive: req.body.to_receive,\r\n    ubication: req.body.ubication,\r\n    images: req.body.images\r\n  };\r\n\r\n  await Product.findByIdAndUpdate(id, { $set: product }, { new: true });\r\n\r\n  res.json({ status: \"200\" });\r\n};\r\n\r\nproductController.getActives = async (req, res) => {\r\n  const products = await Product.find({ active: true });\r\n\r\n  res.json(products);\r\n};\r\n\r\nproductController.getInactives = async (req, res) => {\r\n  const products = await Product.find({ active: false });\r\n\r\n  res.json(products);\r\n};\r\n\r\nproductController.getActivesCount = async (req, res) => {\r\n  const products = await Product.find({ active: true }).countDocuments();\r\n\r\n  res.json(products);\r\n};\r\n\r\nproductController.getInactivesCount = async (req, res) => {\r\n  const products = await Product.find({ active: false }).countDocuments();\r\n\r\n  res.json(products);\r\n};\r\n\r\nproductController.getProduct = async (req, res) => {\r\n  const product = await Product.findById(req.params._id);\r\n\r\n  res.json(product);\r\n};\r\n\r\nproductController.deleteProduct = async (req, res) => {\r\n  const { id } = req.params;\r\n\r\n  await Product.findByIdAndRemove(id);\r\n\r\n  res.json({ status: \"200\" });\r\n};\r\n\r\nproductController.activateProduct = async (req, res) => {\r\n  console.log(req.params);\r\n  const { id } = req.params;\r\n\r\n  await Product.update({ _id: id }, { $set: { active: true } }, () => {\r\n    res.json({ status: \"200\" });\r\n  });\r\n};\r\n\r\nproductController.deactivateProduct = async (req, res) => {\r\n  console.log(req.params);\r\n  const { id } = req.params;\r\n\r\n  await Product.update({ _id: id }, { $set: { active: false } }, () => {\r\n    res.json({ status: \"200\" });\r\n  });\r\n};\r\n\r\nproductController.addImage = async (req, res) => {\r\n  const { _id } = req.params;\r\n\r\n  const image = {\r\n    image: req.body.image\r\n  };\r\n  const product = await Product.findById(_id);\r\n\r\n  product.images.push(image);\r\n  await product.save(err => {\r\n    if (err) {\r\n      res.json(err);\r\n    } else {\r\n      res.json({ status: \"200\" });\r\n    }\r\n  });\r\n};\r\n\r\nproductController.brokenStock = async (req, res) => {\r\n  const broken = await Product.find({\r\n    $where: \"this.broken_stock >= this.stock\"\r\n  });\r\n\r\n  res.json(broken);\r\n};\r\n\r\nmodule.exports = productController;\r\n\r\n/** this ends this file\r\n * server/controllers/product.controller\r\n **/\r\n"]}